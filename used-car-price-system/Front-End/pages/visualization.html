<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>二手车价格系统 - 数据可视化</title>
    <link rel="stylesheet" href="../css/style.css">
    <!-- 引入Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <!-- 引入 ECharts -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.2/dist/echarts.min.js"></script>
    <!-- 引入字体图标 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
</head>
<body>
    <div id="navbar">
        <site-navbar></site-navbar>
    </div>

    <div id="app" class="content-container container">
        <div class="page-header">
            <h1><i class="bi bi-graph-up"></i> 数据可视化</h1>
            <div class="page-actions" v-if="isLoading">
                <div class="loading-indicator">加载中...</div>
            </div>
        </div>
        
        <div class="visualization-container">
            <!-- 价格相关图表 -->
            <section class="chart-section card">
                <div class="section-header">
                    <h2><i class="bi bi-currency-yen"></i> 价格分析</h2>
                </div>
                
                <div class="chart-grid">
                    <div class="chart-item">
                        <div class="chart-header">
                            <h3>价格分布</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" title="下载图表"><i class="bi bi-download"></i></button>
                            </div>
                        </div>
                        <div id="price-range-chart" class="chart"></div>
                    </div>
                    
                    <div class="chart-item">
                        <div class="chart-header">
                            <h3>制造商分布</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" title="下载图表"><i class="bi bi-download"></i></button>
                            </div>
                        </div>
                        <div id="brand-price-chart" class="chart"></div>
                    </div>
                    
                    <div class="chart-item">
                        <div class="chart-header">
                            <h3>里程数与价格的关系</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" title="下载图表"><i class="bi bi-download"></i></button>
                            </div>
                        </div>
                        <div id="price-trend-chart" class="chart"></div>
                    </div>
                    
                    <div class="chart-item">
                        <div class="chart-header">
                            <h3>生产年份与价格的关系</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" title="下载图表"><i class="bi bi-download"></i></button>
                            </div>
                        </div>
                        <div id="age-price-chart" class="chart"></div>
                    </div>
                </div>
            </section>
            
            <!-- 车辆特征分布图表 -->
            <section class="chart-section card">
                <div class="section-header">
                    <h2><i class="bi bi-car-front"></i> 车辆特征分析</h2>
                </div>
                
                <div class="chart-grid">
                    <div class="chart-item">
                        <div class="chart-header">
                            <h3>交易车辆生产年份分布</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" title="下载图表"><i class="bi bi-download"></i></button>
                            </div>
                        </div>
                        <div id="year-distribution-chart" class="chart"></div>
                    </div>
                    
                    <div class="chart-item">
                        <div class="chart-header">
                            <h3>车型分布</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" title="下载图表"><i class="bi bi-download"></i></button>
                            </div>
                        </div>
                        <div id="body-type-chart" class="chart"></div>
                    </div>
                    
                    <div class="chart-item">
                        <div class="chart-header">
                            <h3>里程数分布</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" title="下载图表"><i class="bi bi-download"></i></button>
                            </div>
                        </div>
                        <div id="mileage-distribution-chart" class="chart"></div>
                    </div>
                    
                    <div class="chart-item">
                        <div class="chart-header">
                            <h3>交易地点分布</h3>
                            <div class="chart-actions">
                                <button class="btn-icon" title="下载图表"><i class="bi bi-download"></i></button>
                            </div>
                        </div>
                        <div id="location-distribution-chart" class="chart"></div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <script src="../js/main.js"></script>
    <script src="../js/visualization-api.js"></script>
    <script src="../js/charts.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                isLoading: true,
                error: null,
                errorMessage: ''
            },
            methods: {
                showToast(message, type = 'error') {
                    // 简单的消息提示实现
                    const toast = document.createElement('div');
                    toast.className = `toast toast-${type}`;
                    toast.textContent = message;
                    document.body.appendChild(toast);
                    
                    // 2秒后自动消失
                    setTimeout(() => {
                        toast.classList.add('toast-hide');
                        setTimeout(() => {
                            document.body.removeChild(toast);
                        }, 300);
                    }, 3000);
                }
            },
            mounted() {
                // 注册图表加载状态变化回调
                charts.onLoadingChange((isLoading) => {
                    this.isLoading = isLoading;
                });
                
                // 注册图表错误回调
                charts.onError((errorMessage) => {
                    this.error = true;
                    this.errorMessage = errorMessage;
                    this.showToast(`加载图表失败: ${errorMessage}`, 'error');
                });
                
                // 初始化所有图表
                charts.initAllCharts();
                
                // 添加窗口大小变化监听
                window.addEventListener('resize', () => {
                    charts.resizeAllCharts();
                });
            }
        });
    </script>
    
    <style>
        /* Toast消息样式 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background-color: #f43f5e;
            color: white;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            max-width: 350px;
            animation: toast-in 0.3s ease forwards;
        }
        
        .toast-error {
            background-color: #f43f5e;
        }
        
        .toast-success {
            background-color: #10b981;
        }
        
        .toast-warning {
            background-color: #f59e0b;
        }
        
        .toast-hide {
            animation: toast-out 0.3s ease forwards;
        }
        
        @keyframes toast-in {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes toast-out {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-20px); opacity: 0; }
        }
    </style>
</body>
</html> 